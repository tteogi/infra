{
    "version": 1,
    "serial": 3,
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {
                "bootstrap": "104.199.152.73",
                "sub": "104.199.149.92\n104.155.223.24"
            },
            "resources": {
                "google_compute_instance.bootstrap": {
                    "type": "google_compute_instance",
                    "depends_on": [
                        "template_file.bootstrap",
                        "template_file.bootstrap",
                        "template_file.env"
                    ],
                    "primary": {
                        "id": "nomad-server-bootstrap",
                        "attributes": {
                            "can_ip_forward": "true",
                            "disk.#": "1",
                            "disk.0.auto_delete": "true",
                            "disk.0.device_name": "",
                            "disk.0.disk": "",
                            "disk.0.image": "buddyon-v20160626",
                            "disk.0.scratch": "false",
                            "disk.0.size": "200",
                            "disk.0.type": "",
                            "id": "nomad-server-bootstrap",
                            "machine_type": "custom-1-2048",
                            "metadata.#": "1",
                            "metadata.sshKeys": "core: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfuvpdY6YGFvxVrYg5bsSnwxdpvl3KOfYNkC72ilUcp4Ax+1pP75dalspRylB1D7rrL0xQR0hzKu+7nBcYmvw2EhJifH0ESm3ICKaw0yvy2At6X+UlzR3YhnmJ84+HfLNetdGpc+qRKRR6FZqiO5fUw8Lyp+SAsrWPFOOuHYObUmcLrkJl0Ii/3oEjyWgAXtTcIKn4Iu+utGzmipwmOam0LoWhIrhoF7CBmM1mccSblJ1pCKgGcSyHUb0WwL/Yi1Fh6Vm2VW2g71VydCvr5VEPylsNWd9zoNxEAzUpUM9E4JBfkfLl9bsPReKDvGc0pyLRL6g/23Px2M1C+YlQ40z5 ubuntu@ubuntu-xenial",
                            "metadata_fingerprint": "aunfj1uLy98=",
                            "name": "nomad-server-bootstrap",
                            "network.#": "0",
                            "network_interface.#": "1",
                            "network_interface.0.access_config.#": "1",
                            "network_interface.0.access_config.0.assigned_nat_ip": "104.199.152.73",
                            "network_interface.0.access_config.0.nat_ip": "",
                            "network_interface.0.address": "10.140.0.2",
                            "network_interface.0.name": "nic0",
                            "network_interface.0.network": "default",
                            "network_interface.0.subnetwork": "",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/buddyon-1354/zones/asia-east1-b/instances/nomad-server-bootstrap",
                            "service_account.#": "0",
                            "tags.#": "1",
                            "tags.4115889840": "nomad",
                            "tags_fingerprint": "J2MMSKw9rNA=",
                            "zone": "asia-east1-b"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "google_compute_instance.sub.0": {
                    "type": "google_compute_instance",
                    "depends_on": [
                        "google_compute_instance.bootstrap",
                        "template_file.env",
                        "template_file.sub",
                        "template_file.sub"
                    ],
                    "primary": {
                        "id": "nomad-server-sub0",
                        "attributes": {
                            "can_ip_forward": "true",
                            "disk.#": "1",
                            "disk.0.auto_delete": "true",
                            "disk.0.device_name": "",
                            "disk.0.disk": "",
                            "disk.0.image": "buddyon-v20160626",
                            "disk.0.scratch": "false",
                            "disk.0.size": "200",
                            "disk.0.type": "",
                            "id": "nomad-server-sub0",
                            "machine_type": "custom-1-2048",
                            "metadata.#": "1",
                            "metadata.sshKeys": "core: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfuvpdY6YGFvxVrYg5bsSnwxdpvl3KOfYNkC72ilUcp4Ax+1pP75dalspRylB1D7rrL0xQR0hzKu+7nBcYmvw2EhJifH0ESm3ICKaw0yvy2At6X+UlzR3YhnmJ84+HfLNetdGpc+qRKRR6FZqiO5fUw8Lyp+SAsrWPFOOuHYObUmcLrkJl0Ii/3oEjyWgAXtTcIKn4Iu+utGzmipwmOam0LoWhIrhoF7CBmM1mccSblJ1pCKgGcSyHUb0WwL/Yi1Fh6Vm2VW2g71VydCvr5VEPylsNWd9zoNxEAzUpUM9E4JBfkfLl9bsPReKDvGc0pyLRL6g/23Px2M1C+YlQ40z5 ubuntu@ubuntu-xenial",
                            "metadata_fingerprint": "aunfj1uLy98=",
                            "name": "nomad-server-sub0",
                            "network.#": "0",
                            "network_interface.#": "1",
                            "network_interface.0.access_config.#": "1",
                            "network_interface.0.access_config.0.assigned_nat_ip": "104.199.149.92",
                            "network_interface.0.access_config.0.nat_ip": "",
                            "network_interface.0.address": "10.140.0.3",
                            "network_interface.0.name": "nic0",
                            "network_interface.0.network": "default",
                            "network_interface.0.subnetwork": "",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/buddyon-1354/zones/asia-east1-b/instances/nomad-server-sub0",
                            "service_account.#": "0",
                            "tags.#": "1",
                            "tags.4115889840": "nomad",
                            "tags_fingerprint": "J2MMSKw9rNA=",
                            "zone": "asia-east1-b"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "google_compute_instance.sub.1": {
                    "type": "google_compute_instance",
                    "depends_on": [
                        "google_compute_instance.bootstrap",
                        "template_file.env",
                        "template_file.sub",
                        "template_file.sub"
                    ],
                    "primary": {
                        "id": "nomad-server-sub1",
                        "attributes": {
                            "can_ip_forward": "true",
                            "disk.#": "1",
                            "disk.0.auto_delete": "true",
                            "disk.0.device_name": "",
                            "disk.0.disk": "",
                            "disk.0.image": "buddyon-v20160626",
                            "disk.0.scratch": "false",
                            "disk.0.size": "200",
                            "disk.0.type": "",
                            "id": "nomad-server-sub1",
                            "machine_type": "custom-1-2048",
                            "metadata.#": "1",
                            "metadata.sshKeys": "core: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfuvpdY6YGFvxVrYg5bsSnwxdpvl3KOfYNkC72ilUcp4Ax+1pP75dalspRylB1D7rrL0xQR0hzKu+7nBcYmvw2EhJifH0ESm3ICKaw0yvy2At6X+UlzR3YhnmJ84+HfLNetdGpc+qRKRR6FZqiO5fUw8Lyp+SAsrWPFOOuHYObUmcLrkJl0Ii/3oEjyWgAXtTcIKn4Iu+utGzmipwmOam0LoWhIrhoF7CBmM1mccSblJ1pCKgGcSyHUb0WwL/Yi1Fh6Vm2VW2g71VydCvr5VEPylsNWd9zoNxEAzUpUM9E4JBfkfLl9bsPReKDvGc0pyLRL6g/23Px2M1C+YlQ40z5 ubuntu@ubuntu-xenial",
                            "metadata_fingerprint": "aunfj1uLy98=",
                            "name": "nomad-server-sub1",
                            "network.#": "0",
                            "network_interface.#": "1",
                            "network_interface.0.access_config.#": "1",
                            "network_interface.0.access_config.0.assigned_nat_ip": "104.155.223.24",
                            "network_interface.0.access_config.0.nat_ip": "",
                            "network_interface.0.address": "10.140.0.4",
                            "network_interface.0.name": "nic0",
                            "network_interface.0.network": "default",
                            "network_interface.0.subnetwork": "",
                            "self_link": "https://www.googleapis.com/compute/v1/projects/buddyon-1354/zones/asia-east1-b/instances/nomad-server-sub1",
                            "service_account.#": "0",
                            "tags.#": "1",
                            "tags.4115889840": "nomad",
                            "tags_fingerprint": "J2MMSKw9rNA=",
                            "zone": "asia-east1-b"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "null_resource.cluster.0": {
                    "type": "null_resource",
                    "depends_on": [
                        "google_compute_instance.bootstrap",
                        "google_compute_instance.sub",
                        "google_compute_instance.sub",
                        "google_compute_instance.sub",
                        "google_compute_instance.sub",
                        "template_file.env",
                        "template_file.server_address",
                        "template_file.server_address"
                    ],
                    "primary": {
                        "id": "6489043289567551571",
                        "attributes": {
                            "id": "6489043289567551571",
                            "triggers.#": "1",
                            "triggers.cluster_instance_ids": "nomad-server-sub0,nomad-server-sub1"
                        }
                    }
                },
                "null_resource.cluster.1": {
                    "type": "null_resource",
                    "depends_on": [
                        "google_compute_instance.bootstrap",
                        "google_compute_instance.sub",
                        "google_compute_instance.sub",
                        "google_compute_instance.sub",
                        "google_compute_instance.sub",
                        "template_file.env",
                        "template_file.server_address",
                        "template_file.server_address"
                    ],
                    "primary": {
                        "id": "6650254024141870400",
                        "attributes": {
                            "id": "6650254024141870400",
                            "triggers.#": "1",
                            "triggers.cluster_instance_ids": "nomad-server-sub0,nomad-server-sub1"
                        }
                    }
                },
                "template_file.bootstrap": {
                    "type": "template_file",
                    "primary": {
                        "id": "b31ea229f697bc86318a74363ff1a1867a43182266df5df120e018f0f3e1634f",
                        "attributes": {
                            "id": "b31ea229f697bc86318a74363ff1a1867a43182266df5df120e018f0f3e1634f",
                            "rendered": "# Increase log verbosity\r\nlog_level = \"DEBUG\"\r\n\r\n# Setup data dir\r\ndata_dir = \"/opt/datas/nomad\"\r\n\r\nname = \"nomad-bootstrap-server\"\r\n\r\ndatacenter = \"buddyon\"\r\n\r\n# Enable the server\r\nserver {\r\n    enabled = true\r\n\r\n    # Self-elect, should be 3 or 5 for production\r\n    bootstrap_expect = 3\r\n}",
                            "template": "# Increase log verbosity\r\nlog_level = \"DEBUG\"\r\n\r\n# Setup data dir\r\ndata_dir = \"/opt/datas/nomad\"\r\n\r\nname = \"${node_name}\"\r\n\r\ndatacenter = \"${datacenter}\"\r\n\r\n# Enable the server\r\nserver {\r\n    enabled = true\r\n\r\n    # Self-elect, should be 3 or 5 for production\r\n    bootstrap_expect = ${server_count}\r\n}",
                            "vars.#": "3",
                            "vars.datacenter": "buddyon",
                            "vars.node_name": "nomad-bootstrap-server",
                            "vars.server_count": "3"
                        }
                    }
                },
                "template_file.env": {
                    "type": "template_file",
                    "primary": {
                        "id": "baa4c2d21fb6b2a1e6fce3c835cea5a60eafbcc6f9d1949a754fb151c1c33d29",
                        "attributes": {
                            "id": "baa4c2d21fb6b2a1e6fce3c835cea5a60eafbcc6f9d1949a754fb151c1c33d29",
                            "rendered": "server.env",
                            "template": "server.env"
                        }
                    }
                },
                "template_file.server_address": {
                    "type": "template_file",
                    "primary": {
                        "id": "c8178a4c744d4e98d1e850ad3497f554dae102fba06bc5d4683ddabc253655dd",
                        "attributes": {
                            "id": "c8178a4c744d4e98d1e850ad3497f554dae102fba06bc5d4683ddabc253655dd",
                            "rendered": "#!/bin/bash\nfile_path=$1\nexclude_servers=$2\n\ninclude_servers=\"\"\nfor i in $@\ndo\n    if [ \"$exclude_servers\" != \"$i\" -a $file_path != $i ]; then\n        if [ $include_servers ]; then\n            include_servers+=\",\"\n        fi\n        include_servers+=\"\\\"$i\\\"\"\n    fi\ndone\n\nsed -i 's/\u0026join_servers\u0026/'$include_servers'/g' $file_path\n\necho $include_servers",
                            "template": "#!/bin/bash\nfile_path=$1\nexclude_servers=$2\n\ninclude_servers=\"\"\nfor i in $@\ndo\n    if [ \"$exclude_servers\" != \"$i\" -a $file_path != $i ]; then\n        if [ $include_servers ]; then\n            include_servers+=\",\"\n        fi\n        include_servers+=\"\\\"$i\\\"\"\n    fi\ndone\n\nsed -i 's/\u0026join_servers\u0026/'$include_servers'/g' $file_path\n\necho $include_servers"
                        }
                    }
                },
                "template_file.sub.0": {
                    "type": "template_file",
                    "primary": {
                        "id": "a0b8eb6af2fc0cb85d8c1929ad013c54fbfeda97bdc9debee4ee7b8cc7c881e7",
                        "attributes": {
                            "id": "a0b8eb6af2fc0cb85d8c1929ad013c54fbfeda97bdc9debee4ee7b8cc7c881e7",
                            "rendered": "bind_addr = \"10.21.0.10\"\r\n\r\nadvertise {\r\n  # We need to specify our host's IP because we can't\r\n  # advertise 0.0.0.0 to other nodes in our cluster.\r\n  rpc = \"10.21.0.10:4647\"\r\n}\r\n\r\n# Increase log verbosity\r\nlog_level = \"DEBUG\"\r\n\r\n# Setup data dir\r\ndata_dir = \"/opt/nomad/data\"\r\n\r\n# Enable the server\r\nserver {\r\n    enabled = true\r\n    start_join = [\u0026join_servers\u0026] \r\n    retry_join = [\u0026join_servers\u0026]\r\n    retry_interval = \"15s\"\r\n}\r\n",
                            "template": "bind_addr = \"10.21.0.10\"\r\n\r\nadvertise {\r\n  # We need to specify our host's IP because we can't\r\n  # advertise 0.0.0.0 to other nodes in our cluster.\r\n  rpc = \"10.21.0.10:4647\"\r\n}\r\n\r\n# Increase log verbosity\r\nlog_level = \"DEBUG\"\r\n\r\n# Setup data dir\r\ndata_dir = \"/opt/nomad/data\"\r\n\r\n# Enable the server\r\nserver {\r\n    enabled = true\r\n    start_join = [\u0026join_servers\u0026] \r\n    retry_join = [\u0026join_servers\u0026]\r\n    retry_interval = \"15s\"\r\n}\r\n",
                            "vars.#": "2",
                            "vars.datacenter": "buddyon",
                            "vars.node_name": "nomad-sub0-server"
                        }
                    }
                },
                "template_file.sub.1": {
                    "type": "template_file",
                    "primary": {
                        "id": "a0b8eb6af2fc0cb85d8c1929ad013c54fbfeda97bdc9debee4ee7b8cc7c881e7",
                        "attributes": {
                            "id": "a0b8eb6af2fc0cb85d8c1929ad013c54fbfeda97bdc9debee4ee7b8cc7c881e7",
                            "rendered": "bind_addr = \"10.21.0.10\"\r\n\r\nadvertise {\r\n  # We need to specify our host's IP because we can't\r\n  # advertise 0.0.0.0 to other nodes in our cluster.\r\n  rpc = \"10.21.0.10:4647\"\r\n}\r\n\r\n# Increase log verbosity\r\nlog_level = \"DEBUG\"\r\n\r\n# Setup data dir\r\ndata_dir = \"/opt/nomad/data\"\r\n\r\n# Enable the server\r\nserver {\r\n    enabled = true\r\n    start_join = [\u0026join_servers\u0026] \r\n    retry_join = [\u0026join_servers\u0026]\r\n    retry_interval = \"15s\"\r\n}\r\n",
                            "template": "bind_addr = \"10.21.0.10\"\r\n\r\nadvertise {\r\n  # We need to specify our host's IP because we can't\r\n  # advertise 0.0.0.0 to other nodes in our cluster.\r\n  rpc = \"10.21.0.10:4647\"\r\n}\r\n\r\n# Increase log verbosity\r\nlog_level = \"DEBUG\"\r\n\r\n# Setup data dir\r\ndata_dir = \"/opt/nomad/data\"\r\n\r\n# Enable the server\r\nserver {\r\n    enabled = true\r\n    start_join = [\u0026join_servers\u0026] \r\n    retry_join = [\u0026join_servers\u0026]\r\n    retry_interval = \"15s\"\r\n}\r\n",
                            "vars.#": "2",
                            "vars.datacenter": "buddyon",
                            "vars.node_name": "nomad-sub1-server"
                        }
                    }
                }
            }
        }
    ]
}
