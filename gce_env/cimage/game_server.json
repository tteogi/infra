{
    "variables": {
    "account_file": "{{env `ACCOUNT_FILE`}}",
    "project_id": "{{env `PROJECT_ID`}}",
    "source_image": "{{env `SOURCE_IMAGE`}}",
    "zone": "{{env `ZONE`}}",
    "image_name": "{{env `IMAGE_NAME`}}",
    "image_description": "{{env `IMAGE_DESCRIPTION`}}",
    "machine_type": "{{env `MACHINE_TYPE`}}",
    "util_binaries": "{{env `UTIL_BINARIES`}}"
    },
    "builders": [{
        "type": "googlecompute",
        "account_file": "{{user `account_file`}}",
        "project_id": "{{user `project_id`}}",
        "source_image": "{{user `source_image`}}",
        "zone": "{{user `zone`}}",
        "disk_size": 10,
        "image_name": "{{user `image_name`}}",
        "image_description": "{{user `image_description`}}",
        "machine_type": "{{user `machine_type`}}",
        "ssh_username": "core"
    }],
    "provisioners": [{
        "type": "file",
        "source": "services",
        "destination": "/tmp"
    },
    {
        "type": "file",
        "source": "utils/{{user `util_binaries`}}",
        "destination": "/tmp/{{user `util_binaries`}}"
    },
    {
        "type": "shell",
        "inline": [
            "sudo mkdir -p /opt/bin",
            "sudo tar -xvf /tmp/{{user `util_binaries`}} -C /opt/bin",
            "sudo chmod +x -R /opt/bin",
            "sudo chown root:root -R /opt/bin",
            "sudo mv /tmp/services/*.service /etc/systemd/system",
            "rm -rf /tmp/services",
            "sudo mkdir -p /opt/etc",
            "sudo mkdir -p /opt/datas",
            "sudo mkdir -p /opt/etc/consul.d",
            "sudo mkdir -p /opt/etc/nomad.d",
            "sudo chmod +x -R /opt/etc",
            "sudo chown root:root -R /opt/etc",
            "sudo chmod +x -R /opt/datas",
            "sudo chown root:root -R /opt/datas"
        ]
    }]
}
